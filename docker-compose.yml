version: '3.3'

services:
    php_simple_crud:
        container_name: php_simple_crud
        build:
            context: ./Docker/php
        restart: always
        volumes:
            - ./:/home/app/simple_crud:Z
#            - ./Docker/php/php.ini:/usr/local/etc/php/php.ini
        links:
            - mysql_simple_crud
        working_dir: /home/app/simple_crud

    nginx_simple_crud:
        container_name: nginx_simple_crud
        image: nginx:1.14.2-alpine
        restart: always
        volumes:
            - ./Docker/nginx/vhost.conf:/etc/nginx/conf.d/default.conf
            - ./.:/home/app/simple_crud
        links:
            - php_simple_crud
        ports:
            - "127.0.0.1:82:80"
        working_dir: /home/app/simple_crud


    mysql_simple_crud:
        image: mariadb:10.6
        restart: always
        container_name: mysql_simple_crud
        volumes:
            - ./Docker/mysql/data:/var/lib/mysql
        #      - ./db-init:/docker-entrypoint-initdb.d
        environment:
            - MYSQL_ROOT_PASSWORD=secret
            - MYSQL_DATABASE=simple_crud
            - MYSQL_USER=homestead
            - MYSQL_PASSWORD=secret
        ports:
            - "127.0.0.1:3306:3306"

    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        container_name: simple_crud_phpmyadmin
        restart: always
        environment:
            - PMA_ARBITRARY=1
            - PMA_HOST=mysql_simple_crud
            - PMA_PORT=3306
        ports:
            - "83:80"
        volumes:
            - /sessions
        links:
            - mysql_simple_crud
volumes:
    composer-cache:
